version: "3.7"

services:
  app:
    image: ohg429/shopping_mall
    networks:
      - shopping-mall
    container_name: shoppingApplication
    build:
      context: ./
      dockerfile: Dockerfile
    command: "java -Djava.security.egd=file:/dev/./urandom -jar /shopping-mall.jar"
    environment:
      - SPRING_DATASOURCE_URL=jdbc:mysql://mariadb:3306/shopping_mall
      - SPRING_DATASOURCE_USERNAME=root
      - SPRING_DATASOURCE_PASSWORD=1111
    ports:
        - "80:8080"
    depends_on:
      - db
  #    links:
  #      - db
  #
  db:
    image: mariadb
    restart: always
    ports:
      - "27017:3306"
    volumes:
#     데이터 백업공간
      - /var/lib/mysql
      - ./mycustom.cnf:/etc/mysql/conf.d/custom.cnf
      - ./sql:/docker-entrypoint-initdb.d/
    networks:
      - shopping-mall
    environment:
       MYSQL_ROOT_PASSWORD: 1111
       MYSQL_USER: TEST
       MYSQL_PASSWORD: 1234
    container_name: mariadb
    hostname: mariadb



networks:
  shopping-mall:
    driver: bridge

#    links:
#      - mariadb
#spring:
#  jpa:
#    hibernate:
#      ddl-auto: create
#    database-platform: org.hibernate.dialect.MySQLDialect
#  datasource:
#    url: jdbc:mysql://jdbc:mysql://mariadb:27017/shopping_mall?serverTimezone=UTC
#    username: root
#    password: 1111
#    driver-class-name: com.mysql..cj.jdbc.Driver
#    validation-query: select 1